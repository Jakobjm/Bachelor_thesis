---
title: "Social Identity Salience"
author: "Jakob MÃ¸rup"
date: "11/29/2021"
output: html_document
---
#loading packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(pacman)
p_load(tidyverse,tidytext,RedditExtractoR, lubridate)

```


#1. Scraping Data from Reddit
```{r}
#getting thread URLs
Religion_data <- find_thread_urls(
	keywords = NA,
	sort_by = "top",
	subreddit = "religion",
	period = "week"
)

#fetching content from URLs
religion_threads <- get_thread_content(Religion_data$url)

#flattening to a df
df_rel <- religion_threads[[2]]

#unnesting tokens
tokens_rel <- df_rel %>% unnest_tokens(word, comment)


#getting thread URLs
DebRel_data <- find_thread_urls(
	keywords = NA,
	sort_by = "top",
	subreddit = "DebateReligion",
	period = "week"
)

#fetching content from URLs
DebRel_threads <- get_thread_content(DebRel_data$url)

#flattening to a df
df_DebRel <- DebRel_threads[[2]]

#unnesting tokens
tokens_DebRel <- df_DebRel %>% unnest_tokens(word, comment)

```

#2 Calculating the ratio of group pronouns over words, as a proxy for social identity salience
```{r}
#Defining group and person words
group_words = c("us","we","them","their","our","they")
#person_words = c("i","my","you","your","him","her")

#looking at proportion of plural pronouns in the text of the two subreddits
sum(tokens_rel$word %in% group_words)/length(tokens_rel$word)
sum(tokens_DebRel$word %in% group_words)/length(tokens_DebRel$word)

#proportion of proportions, how many more plural pronouns are used in r/religion than in r/gaming per word used.
(sum(tokens_rel$word %in% group_words)/length(tokens_rel$word))/(sum(tokens_DebRel$word %in% group_words)/length(tokens_DebRel$word))


```


#3 Looking at engagement by author, number of threads and comments and plotting as a bar plot
```{r}
#Subsetting threads and comment by author
aut_rel <- c(religion_threads$threads$author,religion_threads$comments$author)
aut_DebRel <- c(DebRel_threads$threads$author,DebRel_threads$comments$author)


# summarising number of comments+threads by author in the respective dataframes (r/religion and r/DebateReligion), then printing the mean amount of threads+comments by author
rel_authors <- df_rel %>% group_by(author) %>%
	summarise(n = n())
mean(rel_authors$n)
#same as above but for the gaming subreddit
DebRel_authors <- df_DebRel %>% group_by(author) %>%
	summarise(n = n())
mean(DebRel_authors$n)


#plotting a bar chart with number of threads+comments by author for r/religion
ggplot(rel_authors,aes( x = author, y = n))+
	geom_col()
#same as above but for r/DebateReligion
ggplot(DebRel_authors,aes( x = author, y = n))+
	geom_col()
```


#4 Looking at consistency or time active in subreddit

```{r}
dates_DebRel <- df_DebRel %>%
	distinct(author, date, .keep_all = T) %>% 
	group_by(author) %>% 
	summarise(n_dates = n()) %>% 
	mutate(coef_active = n_dates/length(unique(df_DebRel$date)))
 
mean(dates_DebRel$coef_active)

dates_rel <- df_rel %>%
	distinct(author, date, .keep_all = T) %>% 
	group_by(author) %>% 
	summarise(n_dates = n()) %>% 
	mutate(coef_active = n_dates/length(unique(df_rel$date)))
 
mean(dates_rel$coef_active)


```


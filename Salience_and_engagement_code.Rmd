---
title: "Social Identity Salience"
author: "Jakob MÃ¸rup"
date: "11/29/2021"
output: html_document
---
#loading packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(pacman)
p_load(tidyverse,tidytext,pushshiftR, lubridate)

```


#1. Scraping Data from Reddit
#religion and debatereligion
```{r}
#fetching data from r/religion
df_religion <- getPushshiftDataRecursive(postType = "comment", 
																				 size = 1000, 
																				 subreddit = "religion", 
																				 after ="1638313200", 
																				 before = "1638918000", 
																				 nest_level = "5", 
																				 delay = 0.8)

#unnesting tokens
tokens_religion <- df_religion %>% unnest_tokens(word, body)


#---------------------------------------


#fetching data from r/debatereligion
df_debatereligion <- getPushshiftDataRecursive(postType = "comment", 
																				 size = 1000, 
																				 subreddit = "debatereligion", 
																				 after ="1638313200", 
																				 before = "1638918000", 
																				 nest_level = "5", 
																				 delay = 0.8)
#unnesting tokens
tokens_debatereligion <- df_debatereligion %>% unnest_tokens(word, body)

```

#gunpolitics and canadaguns scraping
```{r}
#fetching data from r/gunpolitics
df_gunpolitics <- getPushshiftDataRecursive(postType = "comment", 
																				 size = 1000, 
																				 subreddit = "gunpolitics", 
																				 after ="1638313200", 
																				 before = "1638918000", 
																				 nest_level = "5", 
																				 delay = 0.8)
#unnesting tokens
tokens_gunpolitics <- df_gunpolitics %>% unnest_tokens(word, body)


#---------------------------------------


#fetching data from r/canadaguns
df_canadaguns <- getPushshiftDataRecursive(postType = "comment", 
																				 size = 1000, 
																				 subreddit = "canadaguns", 
																				 after ="1638313200", 
																				 before = "1638918000", 
																				 nest_level = "5", 
																				 delay = 0.8)
#unnesting tokens
tokens_canadaguns <- df_canadaguns %>% unnest_tokens(word, body)
```




#2 Calculating the ratio of group pronouns over words, as a proxy for social identity salience
```{r}
#Defining group and person words
group_words = c("us","we","them","their", "they", "theirs", "themselves", "our", "ours", "ourselves")
#person_words = c("i","my","you","your","him","her")

#looking at proportion of plural pronouns in the text of the two subreddits
sum(tokens_religion$word %in% group_words)/length(tokens_religion$word)
sum(tokens_debatereligion$word %in% group_words)/length(tokens_debatereligion$word)

#proportion of proportions, how many more plural pronouns are used in r/religion than in r/gaming per word used.
(sum(tokens_religion$word %in% group_words)/length(tokens_religion$word))/(sum(tokens_debatereligion$word %in% group_words)/length(tokens_debatereligion$word))



#looking at proportion of plural pronouns in the text of the two subreddits
sum(tokens_gunpolitics$word %in% group_words)/length(tokens_gunpolitics$word)
sum(tokens_canadaguns$word %in% group_words)/length(tokens_canadaguns$word)

#proportion of proportions, how many more plural pronouns are used in r/religion than in r/gaming per word used.
(sum(tokens_gunpolitics$word %in% group_words)/length(tokens_gunpolitics$word))/(sum(tokens_canadaguns$word %in% group_words)/length(tokens_canadaguns$word))


```


#3 Looking at engagement by author, number of threads and comments and plotting as a bar plot
```{r}
#Subsetting threads and comment by author for the two subreds
#aut_religion <- c(religion_threads$threads$author,religion_threads$comments$author)
#aut_debatereligion <- c(debatereligion_threads$threads$author,debatereligion_threads$comments$author)
#
#aut_gunpolitics <- c(gunpolitics_threads$threads$author,gunpolitics_threads$comments$author)
#aut_canadaguns <- c(canadaguns_threads$threads$author,canadaguns_threads$comments$author)


# summarising number of comments+threads by author in the respective dataframes (r/religion and r/gunpolitics), then printing the mean amount of threads+comments by author
religion_authors <- df_religion %>% group_by(author) %>%
	summarise(n = n())
mean(religion_authors$n)
#same as above but for the gaming subreddit
debatereligion_authors <- df_debatereligion %>% group_by(author) %>%
	summarise(n = n())
mean(debatereligion_authors$n)

#same as above but for the gaming subreddit
gunpolitics_authors <- df_gunpolitics %>% group_by(author) %>%
	summarise(n = n())
mean(gunpolitics_authors$n)
#same as above but for the gaming subreddit
canadaguns_authors <- df_canadaguns %>% group_by(author) %>%
	summarise(n = n())
mean(canadaguns_authors$n)


#plotting a bar chart with number of threads+comments by author for r/religion
ggplot(religion_authors,aes( x = author, y = n))+
	geom_col()
#same as above but for r/debatereligion
ggplot(debatereligion_authors,aes( x = author, y = n))+
	geom_col()

#same as above but for r/gunpolitics
ggplot(gunpolitics_authors,aes( x = author, y = n))+
	geom_col()
#same as above but for r/canadaguns
ggplot(canadaguns_authors,aes( x = author, y = n))+
	geom_col()
```


#4 Looking at consistency or time active in subreddit

```{r}
df_debatereligion$date <-  as.Date(as.POSIXct(df_debatereligion$created_utc, origin="1970-01-01"))

dates_debatereligion <- df_debatereligion %>%
	distinct(author, date, .keep_all = T) %>% 
	group_by(author) %>% 
	summarise(n_dates = n()) %>% 
	mutate(coef_active = n_dates/length(unique(df_debatereligion$date)))
 
mean(dates_debatereligion$coef_active)


df_religion$date <-  as.Date(as.POSIXct(df_religion$created_utc, origin="1970-01-01"))

dates_religion <- df_religion %>%
	distinct(author, date, .keep_all = T) %>% 
	group_by(author) %>% 
	summarise(n_dates = n()) %>% 
	mutate(coef_active = n_dates/length(unique(df_religion$date)))
 
mean(dates_religion$coef_active)


#guns

df_gunpolitics$date <-  as.Date(as.POSIXct(df_gunpolitics$created_utc, origin="1970-01-01"))

dates_gunpolitics <- df_gunpolitics %>%
	distinct(author, date, .keep_all = T) %>% 
	group_by(author) %>% 
	summarise(n_dates = n()) %>% 
	mutate(coef_active = n_dates/length(unique(df_gunpolitics$date)))
 
mean(dates_gunpolitics$coef_active)


df_canadaguns$date <-  as.Date(as.POSIXct(df_canadaguns$created_utc, origin="1970-01-01"))

dates_canadaguns <- df_canadaguns %>%
	distinct(author, date, .keep_all = T) %>% 
	group_by(author) %>% 
	summarise(n_dates = n()) %>% 
	mutate(coef_active = n_dates/length(unique(df_canadaguns$date)))
 
mean(dates_canadaguns$coef_active)
```

